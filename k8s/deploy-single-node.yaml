# SPDX-FileCopyrightText: Copyright (c) 2025-2026 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# GLM-4.7-NVFP4 Single Node Deployment
# 1 node, 4 GPUs, TP=4, no disaggregation
# Simplest deployment for testing or low-throughput workloads

apiVersion: nvidia.com/v1alpha1
kind: DynamoGraphDeployment
metadata:
  name: glm47-nvfp4-single
spec:
  envs:
    - name: HF_HOME
      value: /opt/model
    - name: SGLANG_DISABLE_TP_MEMORY_INBALANCE_CHECK
      value: "1"
  pvcs:
    - name: model-cache
      create: false
  services:
    Frontend:
      componentType: frontend
      replicas: 1
      volumeMounts:
        - name: model-cache
          mountPoint: /opt/model
      extraPodSpec:
        mainContainer:
          image: nvcr.io/nvidia/ai-dynamo/sglang-runtime:0.8.1
    worker:
      componentType: worker
      replicas: 1
      multinode:
        nodeCount: 1
      resources:
        limits:
          gpu: "4"
      volumeMounts:
        - name: model-cache
          mountPoint: /opt/model
      sharedMemory:
        size: 40Gi
      extraPodSpec:
        mainContainer:
          image: nvcr.io/nvidia/ai-dynamo/sglang-runtime:0.8.1
          workingDir: /sgl-workspace/dynamo
          command:
            - python3
            - -m
            - dynamo.sglang
          args:
            - --model-path
            - /opt/model/GLM-4.7-NVFP4
            - --served-model-name
            - glm-4.7
            - --trust-remote-code
            - --quantization
            - modelopt_fp4
            - --kv-cache-dtype
            - fp8_e4m3
            - --attention-backend
            - flashinfer
            - --tp
            - "4"
            - --mem-fraction-static
            - "0.85"
            - --stream-interval
            - "10"
            - --watchdog-timeout
            - "600"
            - --host
            - 0.0.0.0
